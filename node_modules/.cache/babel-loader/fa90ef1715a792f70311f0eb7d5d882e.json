{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\victor.abrao\\\\Desktop\\\\source\\\\clientes-blue-cycle-ecommerce\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _objectSpread from\"C:\\\\Users\\\\victor.abrao\\\\Desktop\\\\source\\\\clientes-blue-cycle-ecommerce\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:\\\\Users\\\\victor.abrao\\\\Desktop\\\\source\\\\clientes-blue-cycle-ecommerce\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useRef}from'react';import{fetchLogin,postDevice,fetchSession}from'../services/login-api';import{fetchManufacturers}from'../services/manufacturers-api';import{fetchCategories}from'../services/categories-api';import{fetchVersion,fetchHomolog}from'../services/system-api';import{fetchCartItems}from'../services/cart-api';import{setItemSession,getItemSession}from'../utils';import{deviceType,browserName,browserVersion,osName,osVersion}from\"react-device-detect\";import{v4 as uuidv4}from'uuid';import Cookies from'js-cookie';import{fetchProductsByTagHome}from'../services/products-api';var Login=function Login(props){var _useState=useState({usuario:\"\",senha:\"\"}),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var latestProps=useRef(props);useEffect(function(){// localStorage.clear();\nlatestProps.current=props;},[]);var handleChange=function handleChange(e){var _e$target=e.target,id=_e$target.id,value=_e$target.value;setState(function(prevState){return _objectSpread(_objectSpread({},prevState),{},_defineProperty({},id,value));});};var handleSubmitClick=function handleSubmitClick(e){e.preventDefault();setLoading(true);var usuario=state.usuario;var senha=state.senha;var doLogin=function doLogin(idDevice){fetchLogin(usuario,senha,idDevice).then(function(result){if(result.data.Codigo===200){var resultData=result.data.Data.Retorno;var client={idCliente:resultData.idCliente,idUsuario:resultData.idUsuario,Login:resultData.Login,Nome:resultData.Nome,Email:resultData.Email,ukPedido:resultData.ukPedido,DataEmissao:resultData.DataEmissao,NumeroItens:resultData.NumeroItens,PedidoAlterado:resultData.PedidoAlterado,LinkExpiracaoSessao:resultData.LinkExpiracaoSessao};setItemSession('_dados',JSON.stringify(client));setItemSession('_pedido',client.ukPedido);setItemSession('_token',resultData.TokenResposta);Promise.all([fetchManufacturers(resultData.TokenResposta),fetchCategories(resultData.TokenResposta),fetchVersion(resultData.TokenResposta),fetchHomolog(resultData.TokenResposta),fetchCartItems(resultData.TokenResposta)]).then(function(resultFetch){setItemSession('_fornecedores',JSON.stringify(resultFetch[0].data.Data.Dados));setItemSession('_categorias',JSON.stringify(resultFetch[1].data.Data.Dados));setItemSession('blink_versao',JSON.stringify(resultFetch[2].data.Data));setItemSession('blink_homolog',JSON.stringify(resultFetch[3].data.Data));setItemSession('_carrinho',JSON.stringify(resultFetch[4].data.Data));window.location.href=process.env.REACT_APP_BASE_URL;});}else{latestProps.current.history.push('/unauthorized');};}).catch(function(error){latestProps.current.history.push('/unauthorized');});};var ambiente=process.env.REACT_APP_API_EMPRESA;var isHomolog=ambiente.toLowerCase().includes(\"Teste\")?true:false;var myCookie=Cookies.get('_register_'+isHomolog);var device=myCookie;if(!myCookie||device==null||device==''||device==0){var browser=browserName+' '+browserVersion+' '+deviceType;var so=osName+' '+osVersion;var serialNumber=uuidv4();var uniqueKey=uuidv4();postDevice(browser,so,uniqueKey,serialNumber).then(function(result){Cookies.remove('_register_'+isHomolog);Cookies.set('_register_'+isHomolog,result.data.Data.Retorno,{expires:3650});return result.data.Data.Retorno;}).then(function(result){return doLogin(result);});}else{doLogin(device);}};// se est치 logado, direciona para Home\nif(getItemSession('_token')){fetchSession().then(function(result){if(result.CodigoInterno!=4){window.location.href=process.env.REACT_APP_BASE_URL;}else{localStorage.clear();}});return null;}return/*#__PURE__*/React.createElement(\"section\",{className:\"conteudo_interno container\",id:\"painellogin\"},/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"center\",null,/*#__PURE__*/React.createElement(\"img\",{src:\"/static/media/logo-colorida.0b840118.png\"})),/*#__PURE__*/React.createElement(\"form\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"form-group text-left\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"exampleInputEmail1\"},\"Usu\\xE1rio\"),/*#__PURE__*/React.createElement(\"div\",{class:\"input-group-prepend\"},/*#__PURE__*/React.createElement(\"div\",{class:\"iconlogin\"},/*#__PURE__*/React.createElement(\"svg\",{width:\"1em\",height:\"1em\",viewBox:\"0 0 16 16\",class:\"bi bi-people\",fill:\"currentColor\",xmlns:\"http://www.w3.org/2000/svg\"},/*#__PURE__*/React.createElement(\"path\",{\"fill-rule\":\"evenodd\",d:\"M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1h8zm-7.995-.944v-.002.002zM7.022 13h7.956a.274.274 0 0 0 .014-.002l.008-.002c-.002-.264-.167-1.03-.76-1.72C13.688 10.629 12.718 10 11 10c-1.717 0-2.687.63-3.24 1.276-.593.69-.759 1.457-.76 1.72a1.05 1.05 0 0 0 .022.004zm7.973.056v-.002.002zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0zM6.936 9.28a5.88 5.88 0 0 0-1.23-.247A7.35 7.35 0 0 0 5 9c-4 0-5 3-5 4 0 .667.333 1 1 1h4.216A2.238 2.238 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816zM4.92 10c-1.668.02-2.615.64-3.16 1.276C1.163 11.97 1 12.739 1 13h3c0-1.045.323-2.086.92-3zM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0zm3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4z\"}))),/*#__PURE__*/React.createElement(\"input\",{type:\"text\",className:\"form-control\",id:\"usuario\",\"aria-describedby\":\"usuarioHelp\",placeholder:\"CNPJ\",value:state.usuario,onChange:handleChange}))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-group text-left\"},/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"exampleInputPassword1\"},\"Senha\"),/*#__PURE__*/React.createElement(\"div\",{class:\"input-group-prepend\"},/*#__PURE__*/React.createElement(\"div\",{class:\"iconlogin\"},/*#__PURE__*/React.createElement(\"svg\",{width:\"1em\",height:\"1em\",viewBox:\"0 0 16 16\",class:\"bi bi-key\",fill:\"currentColor\",xmlns:\"http://www.w3.org/2000/svg\"},/*#__PURE__*/React.createElement(\"path\",{\"fill-rule\":\"evenodd\",d:\"M0 8a4 4 0 0 1 7.465-2H14a.5.5 0 0 1 .354.146l1.5 1.5a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0L13 9.207l-.646.647a.5.5 0 0 1-.708 0L11 9.207l-.646.647a.5.5 0 0 1-.708 0L9 9.207l-.646.647A.5.5 0 0 1 8 10h-.535A4 4 0 0 1 0 8zm4-3a3 3 0 1 0 2.712 4.285A.5.5 0 0 1 7.163 9h.63l.853-.854a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.793-.793-1-1h-6.63a.5.5 0 0 1-.451-.285A3 3 0 0 0 4 5z\"}),/*#__PURE__*/React.createElement(\"path\",{d:\"M4 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0z\"}))),/*#__PURE__*/React.createElement(\"input\",{type:\"password\",className:\"form-control\",id:\"senha\",placeholder:\"C\\xF3digo\",value:state.senha,onChange:handleChange}))),/*#__PURE__*/React.createElement(\"div\",{className:\"form-check\"}),/*#__PURE__*/React.createElement(\"button\",{type:\"submit\",id:\"acessarlogin\",className:\"btn btn-primary\",onClick:handleSubmitClick,disabled:loading},loading&&/*#__PURE__*/React.createElement(\"i\",{className:\"fa fa-refresh fa-spin\"}),\"Acessar\"))));};export default Login;","map":{"version":3,"sources":["C:/Users/victor.abrao/Desktop/source/clientes-blue-cycle-ecommerce/src/pages/Login.js"],"names":["React","useState","useEffect","useRef","fetchLogin","postDevice","fetchSession","fetchManufacturers","fetchCategories","fetchVersion","fetchHomolog","fetchCartItems","setItemSession","getItemSession","deviceType","browserName","browserVersion","osName","osVersion","v4","uuidv4","Cookies","fetchProductsByTagHome","Login","props","usuario","senha","state","setState","loading","setLoading","latestProps","current","handleChange","e","target","id","value","prevState","handleSubmitClick","preventDefault","doLogin","idDevice","then","result","data","Codigo","resultData","Data","Retorno","client","idCliente","idUsuario","Nome","Email","ukPedido","DataEmissao","NumeroItens","PedidoAlterado","LinkExpiracaoSessao","JSON","stringify","TokenResposta","Promise","all","resultFetch","Dados","window","location","href","process","env","REACT_APP_BASE_URL","history","push","catch","error","ambiente","REACT_APP_API_EMPRESA","isHomolog","toLowerCase","includes","myCookie","get","device","browser","so","serialNumber","uniqueKey","remove","set","expires","CodigoInterno","localStorage","clear"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { fetchLogin, postDevice, fetchSession } from '../services/login-api';\r\nimport { fetchManufacturers } from '../services/manufacturers-api';\r\nimport { fetchCategories } from '../services/categories-api';\r\nimport { fetchVersion, fetchHomolog } from '../services/system-api';\r\nimport { fetchCartItems } from '../services/cart-api';\r\nimport { setItemSession, getItemSession } from '../utils';\r\n\r\nimport {\r\n    deviceType,\r\n    browserName,\r\n    browserVersion,\r\n    osName,\r\n    osVersion\r\n} from \"react-device-detect\";\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport Cookies from 'js-cookie';\r\nimport { fetchProductsByTagHome } from '../services/products-api';\r\n\r\nconst Login = (props) => {\r\n    const [state, setState] = useState({\r\n        usuario: \"\",\r\n        senha: \"\"\r\n    })\r\n\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const latestProps = useRef(props);\r\n\r\n    useEffect(() => {\r\n        // localStorage.clear();\r\n\r\n        latestProps.current = props;\r\n    }, []);\r\n\r\n    const handleChange = (e) => {\r\n        const { id, value } = e.target\r\n        setState(prevState => ({\r\n            ...prevState,\r\n            [id]: value\r\n        }))\r\n    }\r\n\r\n    const handleSubmitClick = (e) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n        const usuario = state.usuario;\r\n        const senha = state.senha;\r\n\r\n        const doLogin = (idDevice) => {\r\n            fetchLogin(usuario, senha, idDevice)\r\n                .then(result => {\r\n                    if (result.data.Codigo === 200) {\r\n                        const resultData = result.data.Data.Retorno;\r\n                        const client = {\r\n                            idCliente: resultData.idCliente,\r\n                            idUsuario: resultData.idUsuario,\r\n                            Login: resultData.Login,\r\n                            Nome: resultData.Nome,\r\n                            Email: resultData.Email,\r\n                            ukPedido: resultData.ukPedido,\r\n                            DataEmissao: resultData.DataEmissao,\r\n                            NumeroItens: resultData.NumeroItens,\r\n                            PedidoAlterado: resultData.PedidoAlterado,\r\n                            LinkExpiracaoSessao: resultData.LinkExpiracaoSessao\r\n                        }\r\n\r\n                        setItemSession('_dados', JSON.stringify(client));\r\n                        setItemSession('_pedido', client.ukPedido);\r\n                        setItemSession('_token', resultData.TokenResposta);\r\n\r\n                        Promise.all([\r\n                            fetchManufacturers(resultData.TokenResposta),\r\n                            fetchCategories(resultData.TokenResposta),\r\n                            fetchVersion(resultData.TokenResposta),\r\n                            fetchHomolog(resultData.TokenResposta),\r\n                            fetchCartItems(resultData.TokenResposta)\r\n                        ])\r\n                            .then(resultFetch => {\r\n                                setItemSession('_fornecedores', JSON.stringify(resultFetch[0].data.Data.Dados))\r\n                                setItemSession('_categorias', JSON.stringify(resultFetch[1].data.Data.Dados))\r\n                                setItemSession('blink_versao', JSON.stringify(resultFetch[2].data.Data))\r\n                                setItemSession('blink_homolog', JSON.stringify(resultFetch[3].data.Data))\r\n                                setItemSession('_carrinho', JSON.stringify(resultFetch[4].data.Data))\r\n\r\n                                window.location.href = process.env.REACT_APP_BASE_URL\r\n                            })\r\n                    } else {\r\n                        latestProps.current.history.push('/unauthorized');\r\n                    };\r\n\r\n                })\r\n                .catch(error => {\r\n                    latestProps.current.history.push('/unauthorized');\r\n                })\r\n        }\r\n\r\n        var ambiente = process.env.REACT_APP_API_EMPRESA;\r\n\t\tvar isHomolog = ambiente.toLowerCase().includes(\"Teste\") ? true : false;\r\n\t\t\r\n        var myCookie = Cookies.get('_register_' + isHomolog);\r\n        let device = myCookie;\r\n\r\n        if (!myCookie || device == null || device == '' || device == 0) {\r\n            const browser = browserName + ' ' + browserVersion + ' ' + deviceType;\r\n            const so = osName + ' ' + osVersion;\r\n            const serialNumber = uuidv4();\r\n            const uniqueKey = uuidv4();\r\n\r\n            postDevice(browser, so, uniqueKey, serialNumber)\r\n                .then(result => {\r\n                    Cookies.remove('_register_' + isHomolog);\r\n                    Cookies.set('_register_' + isHomolog, result.data.Data.Retorno, { expires: 3650 });\r\n\t\t\t\t\treturn result.data.Data.Retorno;\r\n                })\r\n                .then(result => doLogin(result));\r\n        } else {\r\n            doLogin(device);\r\n        }\r\n    }\r\n\r\n\r\n    // se est치 logado, direciona para Home\r\n    if (getItemSession('_token')) {\r\n        fetchSession()\r\n            .then(result => {\r\n                if (result.CodigoInterno != 4) {\r\n                    window.location.href = process.env.REACT_APP_BASE_URL\r\n                } else {\r\n                    localStorage.clear();\r\n                }\r\n            })\r\n        return null;\r\n    }\r\n\r\n    \r\n    return (\r\n        <section className=\"conteudo_interno container\" id=\"painellogin\">\r\n            \r\n            <div>\r\n                \r\n                <center><img src='/static/media/logo-colorida.0b840118.png'/></center>\r\n                <form>\r\n                    <div className=\"form-group text-left\">\r\n                        <label htmlFor=\"exampleInputEmail1\">Usu치rio</label>\r\n                        <div class=\"input-group-prepend\">\r\n                            <div class=\"iconlogin\">\r\n                                <svg width=\"1em\" height=\"1em\" viewBox=\"0 0 16 16\" class=\"bi bi-people\" fill=\"currentColor\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                    <path fill-rule=\"evenodd\" d=\"M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1h8zm-7.995-.944v-.002.002zM7.022 13h7.956a.274.274 0 0 0 .014-.002l.008-.002c-.002-.264-.167-1.03-.76-1.72C13.688 10.629 12.718 10 11 10c-1.717 0-2.687.63-3.24 1.276-.593.69-.759 1.457-.76 1.72a1.05 1.05 0 0 0 .022.004zm7.973.056v-.002.002zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0zM6.936 9.28a5.88 5.88 0 0 0-1.23-.247A7.35 7.35 0 0 0 5 9c-4 0-5 3-5 4 0 .667.333 1 1 1h4.216A2.238 2.238 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816zM4.92 10c-1.668.02-2.615.64-3.16 1.276C1.163 11.97 1 12.739 1 13h3c0-1.045.323-2.086.92-3zM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0zm3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4z\"/>\r\n                                </svg>\r\n                            </div>\r\n                            \r\n                            <input type=\"text\"\r\n                                className=\"form-control\"\r\n                                id=\"usuario\"\r\n                                aria-describedby=\"usuarioHelp\"\r\n                                placeholder=\"CNPJ\"\r\n                                value={state.usuario}\r\n                                onChange={handleChange}\r\n                                \r\n                            />\r\n                        </div>\r\n\r\n                    </div>\r\n                    <div className=\"form-group text-left\">\r\n                        <label htmlFor=\"exampleInputPassword1\">Senha</label>\r\n                        <div class=\"input-group-prepend\">\r\n                            <div class=\"iconlogin\">\r\n                                <svg width=\"1em\" height=\"1em\" viewBox=\"0 0 16 16\" class=\"bi bi-key\" fill=\"currentColor\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                                    <path fill-rule=\"evenodd\" d=\"M0 8a4 4 0 0 1 7.465-2H14a.5.5 0 0 1 .354.146l1.5 1.5a.5.5 0 0 1 0 .708l-1.5 1.5a.5.5 0 0 1-.708 0L13 9.207l-.646.647a.5.5 0 0 1-.708 0L11 9.207l-.646.647a.5.5 0 0 1-.708 0L9 9.207l-.646.647A.5.5 0 0 1 8 10h-.535A4 4 0 0 1 0 8zm4-3a3 3 0 1 0 2.712 4.285A.5.5 0 0 1 7.163 9h.63l.853-.854a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.646-.647a.5.5 0 0 1 .708 0l.646.647.793-.793-1-1h-6.63a.5.5 0 0 1-.451-.285A3 3 0 0 0 4 5z\"/>\r\n                                    <path d=\"M4 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0z\"/>\r\n                                </svg>\r\n                            </div>\r\n\r\n                            <input type=\"password\"\r\n                                className=\"form-control\"\r\n                                id=\"senha\"\r\n                                placeholder=\"C칩digo\"\r\n                                value={state.senha}\r\n                                onChange={handleChange}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"form-check\">\r\n                    </div>\r\n                    <button\r\n                        type=\"submit\"\r\n                        id=\"acessarlogin\"\r\n                        className=\"btn btn-primary\"\r\n                        onClick={handleSubmitClick}\r\n                        disabled={loading}\r\n                    >\r\n                        {loading && <i className=\"fa fa-refresh fa-spin\"></i>}\r\n                        Acessar\r\n                    </button>\r\n                </form>\r\n            </div>\r\n        </section>\r\n    )\r\n}\r\n\r\nexport default Login;"]},"metadata":{},"sourceType":"module"}