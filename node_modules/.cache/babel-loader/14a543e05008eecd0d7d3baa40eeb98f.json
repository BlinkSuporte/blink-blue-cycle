{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\victor.abrao\\\\Desktop\\\\source\\\\clientes-blue-cycle-ecommerce\\\\src\\\\pages\\\\Auth.js\";\nimport React, { useEffect, useRef } from 'react';\nimport { fetchLoginToken, postDevice } from '../services/login-api';\nimport { AuthLoader } from '../components/Loader/AuthLoader';\nimport { fetchManufacturers } from '../services/manufacturers-api';\nimport { fetchCategories } from '../services/categories-api';\nimport { fetchVersion, fetchHomolog } from '../services/system-api';\nimport { fetchCartItems } from '../services/cart-api';\nimport { setItemSession } from '../utils';\nimport { deviceType, browserName, browserVersion, osName, osVersion } from \"react-device-detect\";\nimport { v4 as uuidv4 } from 'uuid';\nimport Cookies from 'js-cookie';\nimport { fetchProductsByTagHome } from '../services/products-api';\n\nconst Auth = props => {\n  const latestProps = useRef(props);\n  useEffect(() => {\n    latestProps.current = props;\n  });\n  useEffect(() => {\n    localStorage.clear();\n\n    const doLogin = idDevice => {\n      fetchLoginToken(latestProps.current.match.params.token, idDevice).then(result => {\n        console.log(idDevice);\n        console.log(result);\n\n        if (result.data.Codigo === 200) {\n          const resultData = result.data.Data.Retorno;\n          const client = {\n            idCliente: resultData.idCliente,\n            idUsuario: resultData.idUsuario,\n            Login: resultData.Login,\n            Nome: resultData.Nome,\n            Email: resultData.Email,\n            ukPedido: resultData.ukPedido,\n            DataEmissao: resultData.DataEmissao,\n            NumeroItens: resultData.NumeroItens,\n            PedidoAlterado: resultData.PedidoAlterado,\n            LinkExpiracaoSessao: resultData.LinkExpiracaoSessao\n          };\n          setItemSession('auth_token', latestProps.current.match.params.token);\n          setItemSession('_dados', JSON.stringify(client));\n          setItemSession('_pedido', client.ukPedido);\n          setItemSession('_token', resultData.TokenResposta);\n          Promise.all([fetchManufacturers(resultData.TokenResposta), fetchCategories(resultData.TokenResposta), fetchVersion(resultData.TokenResposta), fetchHomolog(resultData.TokenResposta), fetchCartItems(resultData.TokenResposta)]).then(resultFetch => {\n            setItemSession('_fornecedores', JSON.stringify(resultFetch[0].data.Data.Dados));\n            setItemSession('_categorias', JSON.stringify(resultFetch[1].data.Data.Dados));\n            setItemSession('_versao', JSON.stringify(resultFetch[2].data.Data));\n            setItemSession('_homolog', JSON.stringify(resultFetch[3].data.Data));\n            setItemSession('_carrinho', JSON.stringify(resultFetch[4].data.Data));\n            window.location.href = process.env.REACT_APP_BASE_URL;\n          });\n        } else {\n          latestProps.current.history.push('/unauthorized');\n        }\n\n        ;\n      }).catch(error => {\n        latestProps.current.history.push('/unauthorized');\n      });\n    };\n\n    var ambiente = process.env.REACT_APP_API_EMPRESA;\n    var isHomolog = ambiente.toLowerCase().includes(\"Teste\") ? true : false;\n    var myCookie = Cookies.get('_register_' + isHomolog);\n    let device = myCookie;\n\n    if (!myCookie || device == null || device == '' || device == 0) {\n      const browser = browserName + ' ' + browserVersion + ' ' + deviceType;\n      const so = osName + ' ' + osVersion;\n      const serialNumber = uuidv4();\n      const uniqueKey = uuidv4();\n      postDevice(browser, so, uniqueKey, serialNumber).then(result => {\n        Cookies.remove('_register_' + isHomolog);\n        Cookies.set('_register_' + isHomolog, result.data.Data.Retorno, {\n          expires: 3650\n        });\n        return result.data.Data.Retorno;\n      }).then(result => doLogin(result));\n    } else {\n      doLogin(device);\n    }\n  }, []);\n  return /*#__PURE__*/React.createElement(AuthLoader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 12\n    }\n  });\n};\n\nexport default Auth;","map":{"version":3,"sources":["C:/Users/victor.abrao/Desktop/source/clientes-blue-cycle-ecommerce/src/pages/Auth.js"],"names":["React","useEffect","useRef","fetchLoginToken","postDevice","AuthLoader","fetchManufacturers","fetchCategories","fetchVersion","fetchHomolog","fetchCartItems","setItemSession","deviceType","browserName","browserVersion","osName","osVersion","v4","uuidv4","Cookies","fetchProductsByTagHome","Auth","props","latestProps","current","localStorage","clear","doLogin","idDevice","match","params","token","then","result","console","log","data","Codigo","resultData","Data","Retorno","client","idCliente","idUsuario","Login","Nome","Email","ukPedido","DataEmissao","NumeroItens","PedidoAlterado","LinkExpiracaoSessao","JSON","stringify","TokenResposta","Promise","all","resultFetch","Dados","window","location","href","process","env","REACT_APP_BASE_URL","history","push","catch","error","ambiente","REACT_APP_API_EMPRESA","isHomolog","toLowerCase","includes","myCookie","get","device","browser","so","serialNumber","uniqueKey","remove","set","expires"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef } from 'react';\r\nimport { fetchLoginToken, postDevice } from '../services/login-api';\r\nimport { AuthLoader } from '../components/Loader/AuthLoader';\r\nimport { fetchManufacturers } from '../services/manufacturers-api';\r\nimport { fetchCategories } from '../services/categories-api';\r\nimport { fetchVersion, fetchHomolog } from '../services/system-api';\r\nimport { fetchCartItems } from '../services/cart-api';\r\nimport { setItemSession } from '../utils';\r\n\r\nimport {\r\n    deviceType,\r\n    browserName,\r\n    browserVersion,\r\n    osName,\r\n    osVersion\r\n} from \"react-device-detect\";\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport Cookies from 'js-cookie';\r\nimport { fetchProductsByTagHome } from '../services/products-api';\r\n\r\nconst Auth = (props) => {\r\n\r\n    const latestProps = useRef(props);\r\n\r\n    useEffect(() => { latestProps.current = props; });\r\n\r\n    useEffect(() => {\r\n        localStorage.clear();\r\n\r\n        const doLogin = (idDevice) => {\r\n            fetchLoginToken(latestProps.current.match.params.token, idDevice)\r\n                .then(result => {\r\n\t\t\t\t\tconsole.log(idDevice);\r\n\t\t\t\t\tconsole.log(result);\r\n                    if (result.data.Codigo === 200) {\r\n                        const resultData = result.data.Data.Retorno;\r\n                        const client = {\r\n                            idCliente: resultData.idCliente,\r\n                            idUsuario: resultData.idUsuario,\r\n                            Login: resultData.Login,\r\n                            Nome: resultData.Nome,\r\n                            Email: resultData.Email,\r\n                            ukPedido: resultData.ukPedido,\r\n                            DataEmissao: resultData.DataEmissao,\r\n                            NumeroItens: resultData.NumeroItens,\r\n                            PedidoAlterado: resultData.PedidoAlterado,\r\n                            LinkExpiracaoSessao: resultData.LinkExpiracaoSessao\r\n                        }\r\n\r\n                        \r\n                        setItemSession('auth_token', latestProps.current.match.params.token);\r\n                        setItemSession('_dados', JSON.stringify(client));\r\n                        setItemSession('_pedido', client.ukPedido);\r\n                        setItemSession('_token', resultData.TokenResposta);\r\n                    \r\n                        Promise.all([\r\n                            fetchManufacturers(resultData.TokenResposta),\r\n                            fetchCategories(resultData.TokenResposta),\r\n                            fetchVersion(resultData.TokenResposta),\r\n                            fetchHomolog(resultData.TokenResposta),\r\n                            fetchCartItems(resultData.TokenResposta)\r\n                        ])\r\n                            .then(resultFetch => {\r\n                                setItemSession('_fornecedores', JSON.stringify(resultFetch[0].data.Data.Dados));                                \r\n                                setItemSession('_categorias', JSON.stringify(resultFetch[1].data.Data.Dados))\r\n                                setItemSession('_versao', JSON.stringify(resultFetch[2].data.Data))\r\n                                setItemSession('_homolog', JSON.stringify(resultFetch[3].data.Data))\r\n                                setItemSession('_carrinho', JSON.stringify(resultFetch[4].data.Data))\r\n\r\n                                window.location.href = process.env.REACT_APP_BASE_URL\r\n                            })\r\n                    } else {\r\n                        latestProps.current.history.push('/unauthorized');\r\n                    };\r\n\r\n                })\r\n                .catch(error => {\r\n                    latestProps.current.history.push('/unauthorized');\r\n                })\r\n        }\r\n\r\n\t\tvar ambiente = process.env.REACT_APP_API_EMPRESA;\r\n\t\tvar isHomolog = ambiente.toLowerCase().includes(\"Teste\") ? true : false;\r\n\t\t\r\n        var myCookie = Cookies.get('_register_' + isHomolog);\r\n        let device = myCookie;\r\n\r\n        if (!myCookie || device == null || device == '' || device == 0) {\r\n            const browser = browserName + ' ' + browserVersion + ' ' + deviceType;\r\n            const so = osName + ' ' + osVersion;\r\n            const serialNumber = uuidv4();\r\n            const uniqueKey = uuidv4();\r\n\r\n            postDevice(browser, so, uniqueKey, serialNumber)\r\n                .then(result => {\t\t\t\t\r\n                    Cookies.remove('_register_' + isHomolog);\r\n                    Cookies.set('_register_' + isHomolog, result.data.Data.Retorno, { expires: 3650 });\r\n\t\t\t\t\treturn result.data.Data.Retorno;\r\n                })\r\n                .then(result => doLogin(result));\r\n        } else {\r\n            doLogin(device);\r\n        }\r\n    }, [])\r\n\r\n    return <AuthLoader />;\r\n}\r\n\r\nexport default Auth;"]},"metadata":{},"sourceType":"module"}