{"ast":null,"code":"import React,{useEffect,useRef}from'react';import{fetchLoginToken,postDevice}from'../services/login-api';import{AuthLoader}from'../components/Loader/AuthLoader';import{fetchManufacturers}from'../services/manufacturers-api';import{fetchCategories}from'../services/categories-api';import{fetchVersion,fetchHomolog}from'../services/system-api';import{fetchCartItems}from'../services/cart-api';import{setItemSession}from'../utils';import{deviceType,browserName,browserVersion,osName,osVersion}from\"react-device-detect\";import{v4 as uuidv4}from'uuid';import Cookies from'js-cookie';import{fetchProductsByTagHome}from'../services/products-api';var Auth=function Auth(props){var latestProps=useRef(props);useEffect(function(){latestProps.current=props;});useEffect(function(){localStorage.clear();var doLogin=function doLogin(idDevice){fetchLoginToken(latestProps.current.match.params.token,idDevice).then(function(result){console.log(idDevice);console.log(result);if(result.data.Codigo===200){var resultData=result.data.Data.Retorno;var client={idCliente:resultData.idCliente,idUsuario:resultData.idUsuario,Login:resultData.Login,Nome:resultData.Nome,Email:resultData.Email,ukPedido:resultData.ukPedido,DataEmissao:resultData.DataEmissao,NumeroItens:resultData.NumeroItens,PedidoAlterado:resultData.PedidoAlterado,LinkExpiracaoSessao:resultData.LinkExpiracaoSessao};setItemSession('auth_token',latestProps.current.match.params.token);setItemSession('_dados',JSON.stringify(client));setItemSession('_pedido',client.ukPedido);setItemSession('_token',resultData.TokenResposta);Promise.all([fetchManufacturers(resultData.TokenResposta),fetchCategories(resultData.TokenResposta),fetchVersion(resultData.TokenResposta),fetchHomolog(resultData.TokenResposta),fetchCartItems(resultData.TokenResposta)]).then(function(resultFetch){setItemSession('_fornecedores',JSON.stringify(resultFetch[0].data.Data.Dados));setItemSession('_categorias',JSON.stringify(resultFetch[1].data.Data.Dados));setItemSession('_versao',JSON.stringify(resultFetch[2].data.Data));setItemSession('_homolog',JSON.stringify(resultFetch[3].data.Data));setItemSession('_carrinho',JSON.stringify(resultFetch[4].data.Data));window.location.href=process.env.REACT_APP_BASE_URL;});}else{latestProps.current.history.push('/unauthorized');};}).catch(function(error){latestProps.current.history.push('/unauthorized');});};var ambiente=process.env.REACT_APP_API_EMPRESA;var isHomolog=ambiente.toLowerCase().includes(\"Teste\")?true:false;var myCookie=Cookies.get('_register_'+isHomolog);var device=myCookie;if(!myCookie||device==null||device==''||device==0){var browser=browserName+' '+browserVersion+' '+deviceType;var so=osName+' '+osVersion;var serialNumber=uuidv4();var uniqueKey=uuidv4();postDevice(browser,so,uniqueKey,serialNumber).then(function(result){Cookies.remove('_register_'+isHomolog);Cookies.set('_register_'+isHomolog,result.data.Data.Retorno,{expires:3650});return result.data.Data.Retorno;}).then(function(result){return doLogin(result);});}else{doLogin(device);}},[]);return/*#__PURE__*/React.createElement(AuthLoader,null);};export default Auth;","map":{"version":3,"sources":["C:/Users/victor.abrao/Desktop/source/clientes-blue-cycle-ecommerce/src/pages/Auth.js"],"names":["React","useEffect","useRef","fetchLoginToken","postDevice","AuthLoader","fetchManufacturers","fetchCategories","fetchVersion","fetchHomolog","fetchCartItems","setItemSession","deviceType","browserName","browserVersion","osName","osVersion","v4","uuidv4","Cookies","fetchProductsByTagHome","Auth","props","latestProps","current","localStorage","clear","doLogin","idDevice","match","params","token","then","result","console","log","data","Codigo","resultData","Data","Retorno","client","idCliente","idUsuario","Login","Nome","Email","ukPedido","DataEmissao","NumeroItens","PedidoAlterado","LinkExpiracaoSessao","JSON","stringify","TokenResposta","Promise","all","resultFetch","Dados","window","location","href","process","env","REACT_APP_BASE_URL","history","push","catch","error","ambiente","REACT_APP_API_EMPRESA","isHomolog","toLowerCase","includes","myCookie","get","device","browser","so","serialNumber","uniqueKey","remove","set","expires"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef } from 'react';\r\nimport { fetchLoginToken, postDevice } from '../services/login-api';\r\nimport { AuthLoader } from '../components/Loader/AuthLoader';\r\nimport { fetchManufacturers } from '../services/manufacturers-api';\r\nimport { fetchCategories } from '../services/categories-api';\r\nimport { fetchVersion, fetchHomolog } from '../services/system-api';\r\nimport { fetchCartItems } from '../services/cart-api';\r\nimport { setItemSession } from '../utils';\r\n\r\nimport {\r\n    deviceType,\r\n    browserName,\r\n    browserVersion,\r\n    osName,\r\n    osVersion\r\n} from \"react-device-detect\";\r\nimport { v4 as uuidv4 } from 'uuid';\r\nimport Cookies from 'js-cookie';\r\nimport { fetchProductsByTagHome } from '../services/products-api';\r\n\r\nconst Auth = (props) => {\r\n\r\n    const latestProps = useRef(props);\r\n\r\n    useEffect(() => { latestProps.current = props; });\r\n\r\n    useEffect(() => {\r\n        localStorage.clear();\r\n\r\n        const doLogin = (idDevice) => {\r\n            fetchLoginToken(latestProps.current.match.params.token, idDevice)\r\n                .then(result => {\r\n\t\t\t\t\tconsole.log(idDevice);\r\n\t\t\t\t\tconsole.log(result);\r\n                    if (result.data.Codigo === 200) {\r\n                        const resultData = result.data.Data.Retorno;\r\n                        const client = {\r\n                            idCliente: resultData.idCliente,\r\n                            idUsuario: resultData.idUsuario,\r\n                            Login: resultData.Login,\r\n                            Nome: resultData.Nome,\r\n                            Email: resultData.Email,\r\n                            ukPedido: resultData.ukPedido,\r\n                            DataEmissao: resultData.DataEmissao,\r\n                            NumeroItens: resultData.NumeroItens,\r\n                            PedidoAlterado: resultData.PedidoAlterado,\r\n                            LinkExpiracaoSessao: resultData.LinkExpiracaoSessao\r\n                        }\r\n\r\n                        \r\n                        setItemSession('auth_token', latestProps.current.match.params.token);\r\n                        setItemSession('_dados', JSON.stringify(client));\r\n                        setItemSession('_pedido', client.ukPedido);\r\n                        setItemSession('_token', resultData.TokenResposta);\r\n                    \r\n                        Promise.all([\r\n                            fetchManufacturers(resultData.TokenResposta),\r\n                            fetchCategories(resultData.TokenResposta),\r\n                            fetchVersion(resultData.TokenResposta),\r\n                            fetchHomolog(resultData.TokenResposta),\r\n                            fetchCartItems(resultData.TokenResposta)\r\n                        ])\r\n                            .then(resultFetch => {\r\n                                setItemSession('_fornecedores', JSON.stringify(resultFetch[0].data.Data.Dados));                                \r\n                                setItemSession('_categorias', JSON.stringify(resultFetch[1].data.Data.Dados))\r\n                                setItemSession('_versao', JSON.stringify(resultFetch[2].data.Data))\r\n                                setItemSession('_homolog', JSON.stringify(resultFetch[3].data.Data))\r\n                                setItemSession('_carrinho', JSON.stringify(resultFetch[4].data.Data))\r\n\r\n                                window.location.href = process.env.REACT_APP_BASE_URL\r\n                            })\r\n                    } else {\r\n                        latestProps.current.history.push('/unauthorized');\r\n                    };\r\n\r\n                })\r\n                .catch(error => {\r\n                    latestProps.current.history.push('/unauthorized');\r\n                })\r\n        }\r\n\r\n\t\tvar ambiente = process.env.REACT_APP_API_EMPRESA;\r\n\t\tvar isHomolog = ambiente.toLowerCase().includes(\"Teste\") ? true : false;\r\n\t\t\r\n        var myCookie = Cookies.get('_register_' + isHomolog);\r\n        let device = myCookie;\r\n\r\n        if (!myCookie || device == null || device == '' || device == 0) {\r\n            const browser = browserName + ' ' + browserVersion + ' ' + deviceType;\r\n            const so = osName + ' ' + osVersion;\r\n            const serialNumber = uuidv4();\r\n            const uniqueKey = uuidv4();\r\n\r\n            postDevice(browser, so, uniqueKey, serialNumber)\r\n                .then(result => {\t\t\t\t\r\n                    Cookies.remove('_register_' + isHomolog);\r\n                    Cookies.set('_register_' + isHomolog, result.data.Data.Retorno, { expires: 3650 });\r\n\t\t\t\t\treturn result.data.Data.Retorno;\r\n                })\r\n                .then(result => doLogin(result));\r\n        } else {\r\n            doLogin(device);\r\n        }\r\n    }, [])\r\n\r\n    return <AuthLoader />;\r\n}\r\n\r\nexport default Auth;"]},"metadata":{},"sourceType":"module"}